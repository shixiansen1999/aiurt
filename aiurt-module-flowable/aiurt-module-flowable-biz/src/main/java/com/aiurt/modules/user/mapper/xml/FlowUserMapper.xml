<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiurt.modules.user.mapper.FlowUserMapper">

    <select id="getUserNameByUserId" resultType="java.lang.String">
        select username from sys_user where del_flag = 0 and  status = 1
        <if test="userIdList != null and userIdList.size() != 0">
            and  id in
            <foreach collection="userIdList" separator="," open="(" close=")" item="item">
                #{item}
            </foreach>
        </if>
    </select>

    <select id="getUserNameByRoleId" resultType="java.lang.String">
        select a.username from sys_user a Left Join sys_user_role b On a.id = b.user_id
        where a.del_flag = 0 and a.status = 1
        <if test="roleIdList != null and roleIdList.size() != 0">
            and b.role_id in
            <foreach collection="roleIdList" separator="," open="(" close=")" item="item">
                #{item}
            </foreach>
        </if>
    </select>

    <select id="getUserNameByOrgId" resultType="java.lang.String">
        select username from sys_user where del_flag = 0 and  status = 1
        <if test="orgIdList != null and orgIdList.size() != 0">
            and  org_id in
            <foreach collection="orgIdList" separator="," open="(" close=")" item="item">
                #{item}
            </foreach>
        </if>
    </select>

    <select id="getUserName" resultType="java.lang.String">
        select username from sys_user where del_flag = 0 and  status = 1
        and (username like CONCAT ('%', #{name}, '%')  or id = #{name} or realname like CONCAT ('%', #{name}, '%'))
    </select>

    <select id="getManageUserName" resultType="java.lang.String">
        select t3.username from  sys_depart t2
        left join sys_user t3 ON (t2.manager_id = t3.id)
        where t3.del_flag = 0 and t3.status = 1 and t2.id = #{orgId}
    </select>

    <select id="getParentManageUserName" resultType="java.lang.String">
        select t3.username from  sys_depart t1
        left join sys_depart t2 ON (t1.parent_id = t2.id)
        left join sys_user t3 ON (t2.manager_id = t3.id)
        where t3.del_flag = 0 and t3.status = 1 and t1.id = #{orgId}
    </select>

    <select id="getUserNameByUserIdOrUserName" resultType="java.lang.String">
        select username from sys_user where del_flag = 0 and  status = 1
        <if test="userIdList != null and userIdList.size() != 0">
            and (id in
            <foreach collection="userIdList" separator="," open="(" close=")" item="item">
                #{item}
            </foreach>
            or username in
            <foreach collection="userIdList" separator="," open="(" close=")" item="item">
                #{item}
            </foreach>
            )
        </if>
    </select>

    <select id="getUserNameByRoleIdOrRoleCode" resultType="java.lang.String">
        select a.username from sys_user a Left Join sys_user_role b On a.id = b.user_id
        left join sys_role c ON (b.role_id = c.id)
        where a.del_flag = 0 and a.status = 1
        <if test="roleIdList != null and roleIdList.size() != 0">
            and (b.role_id in
            <foreach collection="roleIdList" separator="," open="(" close=")" item="item">
                #{item}
            </foreach>
                or c.role_code in
            <foreach collection="roleIdList" separator="," open="(" close=")" item="item">
                #{item}
            </foreach>
            )
        </if>
    </select>

    <select id="getUserNameByOrgIdOrOrgCode" resultType="java.lang.String">
        select username from sys_user t1
        left join sys_depart t2 ON  (t1.org_id = t2.id)
        where del_flag = 0 and  status = 1
        <if test="orgIdList != null and orgIdList.size() != 0">
            and ( t1.org_id in
            <foreach collection="orgIdList" separator="," open="(" close=")" item="item">
                #{item}
            </foreach>
            or t2.org_code in
            <foreach collection="orgIdList" separator="," open="(" close=")" item="item">
                #{item}
            </foreach>
            )
        </if>
    </select>

    <select id="getUserNameByPost" resultType="java.lang.String">

            select username from sys_user where status =1 and del_flag=0
             <if test="postList != null and postList.size() != 0">
                 and
                 <foreach collection="postList" separator="or" open="(" close=")" item="post">
                       find_in_set(#{post}, job_name) > 0
                 </foreach>
            </if>
    </select>
</mapper>
