@startuml
participant Actor
Actor -> BpmnDesignerController : 根据modelId查询流程模板
activate BpmnDesignerController
BpmnDesignerController -> IFlowableBpmnService : 加载流程模板
activate IFlowableBpmnService
IFlowableBpmnService-> MyModelServiceImpl:获取BpmnXMl
activate MyModelServiceImpl
MyModelServiceImpl->MyModelServiceImpl : getBpmnModel(获取BpmnModel)
activate MyModelServiceImpl
MyModelServiceImpl->MyModelServiceImpl : getBpmnModel(获取BpmnModel)
MyModelServiceImpl->CustomBpmnJsonConverter : convertToBpmnModel(json 转 BpmnModel)
activate CustomBpmnJsonConverter
CustomBpmnJsonConverter->BpmnJsonConverter:super.convertToBpmnModel
activate BpmnJsonConverter
BpmnJsonConverter->BpmnJsonConverter: 全局属性转换
activate BpmnJsonConverter
       loop 各个节点属性
         BpmnJsonConverter -> CustomUserTaskJsonConverter: 用户任务属性转换
         activate CustomUserTaskJsonConverter
         CustomUserTaskJsonConverter->UserTaskJsonConverter:用户基础属性转json
         activate UserTaskJsonConverter
         UserTaskJsonConverter-->CustomUserTaskJsonConverter
         deactivate UserTaskJsonConverter
         CustomUserTaskJsonConverter->CustomUserTaskJsonConverter:用户自定义属性转换(节点前后操做，办理人，抄送人等)
         CustomUserTaskJsonConverter-->BpmnJsonConverter
         deactivate CustomUserTaskJsonConverter
         BpmnJsonConverter->CustomSequenceFlowJsonConverter: 流转线属性转换
         activate CustomSequenceFlowJsonConverter
         CustomSequenceFlowJsonConverter->CustomSequenceFlowJsonConverter: 基础属性
         CustomSequenceFlowJsonConverter->CustomSequenceFlowJsonConverter: 自定义属性(流转条件，流转类型)
         CustomSequenceFlowJsonConverter-->BpmnJsonConverter
         deactivate CustomSequenceFlowJsonConverter
       end
deactivate BpmnJsonConverter
BpmnJsonConverter-->CustomBpmnJsonConverter:BpmnModel
deactivate BpmnJsonConverter
CustomBpmnJsonConverter->CustomBpmnJsonConverter: 自定义属性处理(催办，流程撤回，审批人去重)
CustomBpmnJsonConverter-->MyModelServiceImpl:BpmnModel
deactivate CustomBpmnJsonConverter
MyModelServiceImpl->bpmnXMLConverter:convertToXML
activate bpmnXMLConverter
bpmnXMLConverter-->MyModelServiceImpl:字节数组bpmnXML
deactivate bpmnXMLConverter
deactivate MyModelServiceImpl
MyModelServiceImpl-->IFlowableBpmnService:字节数组bpmnXML
deactivate MyModelServiceImpl
IFlowableBpmnService->IFlowableBpmnService:数据组装
IFlowableBpmnService->BpmnDesignerController
deactivate IFlowableBpmnService
BpmnDesignerController -> Result : ok
activate Result
Result --> BpmnDesignerController
deactivate Result
@enduml
