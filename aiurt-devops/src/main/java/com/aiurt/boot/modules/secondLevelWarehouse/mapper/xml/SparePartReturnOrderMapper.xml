<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiurt.boot.modules.secondLevelWarehouse.mapper.SparePartReturnOrderMapper">
    <select id="queryPageList" resultType="com.aiurt.boot.modules.secondLevelWarehouse.entity.vo.SparePartReturnVO">
        SELECT
        	spro.id AS id,
	        cs.system_name AS `system`,
	        spro.material_code AS materialCode,
	        mb.`name` AS materialName,
	        mb.type AS `type`,
	        mb.specifications AS specifications,
	        mb.manufacturer AS manufacturer,
	        mb.unit AS unit,
			sd.depart_name AS orgId,
	        spro.num AS num,
	        spro.return_time AS returnTime,
	        spro.remarks AS remarks,
	        su.realname AS createBy
        FROM
	        spare_part_return_order spro
	        LEFT JOIN material_base mb ON mb.`code` = spro.material_code
	        LEFT JOIN cs_subsystem cs ON cs.system_code = mb.system_code
			LEFT JOIN sys_depart sd ON sd.id = spro.org_id
	        LEFT JOIN sys_user su ON su.id = spro.create_by
        WHERE
			spro.del_flag = 0
	        <if test="param.orgId!=null and param.orgId!=''">
	            AND spro.org_id = #{param.orgId}
            </if>
            <if test="param.type!=null">
	            AND mb.type = #{param.type}
            </if>
            <if test="param.materialCode!=null and param.materialCode!=''">
	            AND spro.material_code LIKE CONCAT( '%', #{param.materialCode}, '%' )
            </if>
            <if test="param.materialName!=null and param.materialName!=''">
	            AND mb.`name` LIKE CONCAT( '%', #{param.materialName}, '%' )
            </if>
			<if test="param.selections != null">
				AND spro.id in(
				<foreach collection="param.selections" separator="," item="item">
					#{item}
				</foreach>
				)
		</if>
		ORDER BY
	        spro.create_time DESC
    </select>

    <select id="exportXls" resultType="com.aiurt.boot.modules.secondLevelWarehouse.entity.vo.SparePartReturnVO">
        SELECT
        	spro.id AS id,
	        cs.system_name AS `system`,
	        spro.material_code AS materialCode,
	        mb.`name` AS materialName,
	        mb.type AS `type`,
	        mb.specifications AS specifications,
	        mb.manufacturer AS manufacturer,
	        mb.unit AS unit,
			sd.depart_name AS orgId,
	        spro.num AS num,
	        spro.return_time AS returnTime,
	        spro.remarks AS remarks,
	        su.realname AS createBy
        FROM
	        spare_part_return_order spro
	        LEFT JOIN material_base mb ON mb.`code` = spro.material_code
	        LEFT JOIN cs_subsystem cs ON cs.system_code = mb.system_code
			LEFT JOIN sys_depart sd ON sd.id = spro.org_id
	        LEFT JOIN sys_user su ON su.id = spro.create_by
        WHERE
			spro.del_flag = 0
	        <if test="param.orgId!=null and param.orgId!=''">
	            AND spro.org_id = #{param.orgId}
            </if>
            <if test="param.type!=null">
	            AND mb.type = #{param.type}
            </if>
            <if test="param.materialCode!=null and param.materialCode!=''">
	            AND spro.material_code LIKE CONCAT( '%', #{param.materialCode}, '%' )
            </if>
            <if test="param.materialName!=null and param.materialName!=''">
	            AND mb.`name` LIKE CONCAT( '%', #{param.materialName}, '%' )
            </if>
			<if test="param.selections != null">
				AND spro.id in(
				<foreach collection="param.selections" separator="," item="item">
					#{item}
				</foreach>
				)
		</if>
		ORDER BY
	        spro.create_time DESC
    </select>

</mapper>
