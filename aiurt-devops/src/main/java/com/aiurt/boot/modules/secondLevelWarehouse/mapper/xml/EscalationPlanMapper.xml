<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiurt.boot.modules.secondLevelWarehouse.mapper.EscalationPlanMapper">
	<select id="selectExportXls" resultType="com.aiurt.boot.modules.secondLevelWarehouse.vo.EscalationPlanExportVO">
		SELECT d1.item_text AS reportType,
		       d2.item_text AS sourceFunds,
		       p.org_id,
		       p.report_year,
		       p.specialty_type,
		       p.system_name,
		       p.`name`,
		       p.unit,
		       p.brand,
		       p.specifications,
		       p.`parameter`,
		       p.nums,
		       p.arrival_num,
		       p.unit_price,
		       p.total_price,
		       p.purchase_time,
		       p.img_url
		<!--dep.depart_name as orgId,-->
		FROM t_escalation_plan p
				     LEFT JOIN sys_dict as dict1 ON dict1.dict_code = 'escalation_type'
				     LEFT JOIN sys_dict_item as d1 ON d1.item_value = p.report_type
				AND dict1.id = d1.dict_id
				     LEFT JOIN sys_dict as dict2 ON dict2.dict_code = 'source_funds'
				     LEFT JOIN sys_dict_item as d2 ON d2.item_value = p.source_funds
				AND dict2.id = d2.dict_id
		<!--LEFT JOIN sys_depart dep on dep.id = p.org_id-->
		where p.del_flag = 0
		  and (dict1.del_flag = 0 or dict1.del_flag is null)
		  and (dict2.del_flag = 0 or dict2.del_flag is null)
		<if test="param != null">
			<if test="param.id != null and param.id != ''">
				and p.id in #{param.id}
			</if>
			<if test="param.name != null and param.name != ''">
				and p.name like concat('%', #{param.name}, '%')
			</if>
			<if test="param.reportYear != null and param.reportYear != ''">
				and p.report_year like concat('%', #{param.reportYear}, '%')
			</if>
			<if test="param.reportType != null">
				and p.report_type = #{param.reportType}
			</if>
			<if test="param.systemType != null">
				and p.system_type = #{param.systemType}
			</if>
		</if>
		<if test="systemCodes != null and systemCodes.size() != 0">
			and p.system_type in
			<foreach collection="systemCodes" item="code" open="(" close=")" separator=",">
				#{code}
			</foreach>
		</if>
		order by p.id desc
	</select>
</mapper>
