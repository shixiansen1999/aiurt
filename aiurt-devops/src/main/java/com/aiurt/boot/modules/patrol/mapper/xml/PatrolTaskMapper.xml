<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.swsc.copsms.modules.patrol.mapper.PatrolTaskMapper">
	<select id="selectPageList" resultType="com.swsc.copsms.modules.patrol.vo.PatrolTaskVO">
		select t.id,
		       p.patrol_name as name,
		       t.code,
		       p.system_type,
		       p.organization_id,
		       p.tactics,
		       t.staff_ids,
		       t.submit_time,
		       t.create_time,
		       p.execution_time,
		       t.ignore_content,
		       t.ignore_status,
		       t.ignore_time
		from patrol_task t
				     left join patrol_pool p on p.id = t.patrol_pool_id
				where p.del_flag = 0
				  and t.del_flag = 0
				  and t.status = 1
				  and p.status = 1
				  and t.type = #{param.type}
		<if test="param.ignoreStatus != null">
			and param.ignoreStatus = #{param.ignoreStatus}
		</if>


		<if test="param.patrolName != null and param.patrolName != ''">
			and p.patrol_name like concat('%'
					, #{param.patrolName}
					, '%')
		</if>
		<if test="param.organizationId != null">
			and p.organization_id = #{param.organizationId}
		</if>
		<if test="param.id != null and param.id != ''">
			and t.staff_ids like concat('%'
					, #{param.id}
					, '%')
		</if>
		<if test="param.startTime != null">
			and t.submit_time &gt;= #{param.startTime}
		</if>
		<if test="param.endTime != null">
			and t.submit_time &lt;= #{param1.endTime}
		</if>

		order by id
	</select>
</mapper>