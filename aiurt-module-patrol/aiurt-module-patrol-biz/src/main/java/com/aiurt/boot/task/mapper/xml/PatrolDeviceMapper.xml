<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiurt.boot.task.mapper.PatrolDeviceMapper">

    <select id="queryDevices" resultType="com.aiurt.boot.task.dto.PatrolDeviceDTO">
        SELECT
            pd.*,
            d.`name` AS deviceName
        FROM
            patrol_device pd
                LEFT JOIN device d ON d.`code` = pd.device_code
        WHERE
            pd.del_flag = 0
            AND pd.task_id = #{taskId}
            AND pd.task_standard_id = #{taskStandardId}
    </select>
    <select id="queryDevicesDetail" resultType="com.aiurt.boot.task.dto.DeviceDTO">
        SELECT
            pd.device_code AS code,
            d.id,
            d.name,
            d.status,
            d.temporary,
            d.position_code,
            dt.`name` AS deviceType,
            cm.major_code,
            cm.major_name AS majorCodeName,
            cs.system_name AS systemCodeName,
            cs.system_code,
            cl.line_name,
            cst.station_name,
            csp.position_name
        FROM
            patrol_device pd
                LEFT JOIN device d ON pd.device_code = d.`code`
                LEFT JOIN device_type dt ON dt.`code` = d.device_type_code
                LEFT JOIN cs_major cm ON cm.major_code = d.major_code
                LEFT JOIN cs_subsystem cs ON cs.system_code = d.system_code
                LEFT JOIN cs_line cl ON cl.line_code = d.line_code
                LEFT JOIN cs_station cst ON cst.station_code = d.station_code
                LEFT JOIN cs_station_position csp ON csp.position_code = d.position_code
        WHERE
            pd.del_flag = 0
            AND pd.task_id = #{taskId}
            AND pd.task_standard_id = #{taskStandardId}
    </select>
</mapper>