<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiurt.boot.standard.mapper.PatrolStandardMapper">

    <select id="pageList" resultType="com.aiurt.boot.standard.dto.PatrolStandardDto">
        select *,b.major_name as professionName, c.system_name as subsystemName ,d.name as deviceTypeName
               from patrol_standard as a
        left join cs_major b on a.profession_code =b.major_code
        left join cs_subsystem c on a.subsystem_code =c.system_code
        left join device_type d on a.device_type_code =d.code
        where a.del_flag =0
        <if test="patrolStandard.name !=null ">
            AND a.name LIKE CONCAT ('%', #{patrolStandard.name}, '%')
        </if>
        <if test="patrolStandard.professionCode !=null ">
            AND a.profession_code = #{patrolStandard.professionCode}
        </if>
        <if test="patrolStandard.subsystemCode !=null ">
            AND a.subsystem_code = #{patrolStandard.subsystemCode}
        </if>
        <if test="patrolStandard.code !=null ">
            AND a.code = #{patrolStandard.code}
        </if>
        <if test="patrolStandard.createBy !=null ">
            AND a.create_by = #{patrolStandard.createBy}
        </if>
        <if test="patrolStandard.status !=null ">
            AND a.status = #{patrolStandard.status}
        </if>
        order by a.create_time desc
    </select>
    <select id="list" resultType="com.aiurt.boot.standard.dto.InspectionStandardDto">
        <if test="professionCode ==null and subsystemCode == null">
        select b.major_name as professionName,b.major_code as professionCode
        from cs_major as b
        where
        b.del_flag =0
        </if>
        <if test="professionCode !=null and subsystemCode == null">
            SELECT c.system_name as subsystemName, c.system_code as subsystemCode
            FROM cs_subsystem c
            WHERE c.del_flag =0 and c.major_code= #{professionCode}
        </if>
        <if test="professionCode !=null and subsystemCode != null ">
            SELECT d.name as deviceTypeName ,d.code as deviceTypeCode
            FROM device_type d
            WHERE d.del_flag =0 and d.major_code= #{professionCode}
            AND d.system_code = #{subsystemCode}
        </if>
    </select>
    <select id="selectbyIds" resultType="com.aiurt.boot.standard.dto.PatrolStandardDto">
        select a.*,b.major_name as professionName, c.system_name as subsystemName ,d.name as deviceTypeName
        from patrol_standard as a
                 left join cs_major b on a.profession_code =b.major_code
                 left join cs_subsystem c on a.subsystem_code =c.system_code
                 left join device_type d on a.device_type_code =d.code
        where a.del_flag =0 and a.id in
        <foreach collection="ids" open="(" close=")"  index="index"   separator="," item="ids">
           #{ids}
        </foreach>
    </select>

</mapper>
