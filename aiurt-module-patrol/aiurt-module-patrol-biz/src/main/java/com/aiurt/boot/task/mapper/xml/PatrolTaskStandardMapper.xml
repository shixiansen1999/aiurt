<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiurt.boot.task.mapper.PatrolTaskStandardMapper">
    <select id="getMajorSystemName" resultType="com.aiurt.boot.task.dto.PatrolTaskStandardDTO">
        SELECT t2.major_name as majorName,t3.system_name sysName
        FROM patrol_task_standard t1
        LEFT JOIN cs_major t2 ON t1.profession_code = t2.major_code and t2.del_flag = 0
        LEFT JOIN cs_subsystem t3 ON t1.subsystem_code = t3.system_code and t3.del_flag = 0
        AND t2.major_code = t3.major_code
        where t1.task_id= #{id}
        and t2.major_name is not null and t3.system_name is not null
    </select>
    <select id="getStandard" resultType="com.aiurt.boot.task.dto.PatrolTaskStandardDTO">
         SELECT
            t1.id AS taskStandardId,
            t1.task_id AS taskId,
            t2.id AS standardId,
            t3.NAME AS deviceTypeName,
            t4.major_name AS majorName,
            t5.system_name AS sysName,
            t2.*
        FROM
            patrol_task_standard t1
            LEFT JOIN patrol_standard t2 ON t1.standard_id = t2.id
            LEFT JOIN device_type t3 ON t2.device_type_code = t3.code and t3.del_flag = 0
            LEFT JOIN cs_major t4 ON t1.profession_code = t4.major_code and t4.del_flag = 0
            LEFT JOIN cs_subsystem t5 ON t1.subsystem_code = t5.system_code and t5.del_flag = 0
        WHERE
            t1.task_id = #{taskId}
</select>

    <select id="getTaskCodeByUserMajorSystem" resultType="java.lang.String">
        select distinct patrol_task.`code`
        from patrol_task_standard patrol_task_standard
                 join patrol_task patrol_task on patrol_task_standard.task_id = patrol_task.id
            and patrol_task.del_flag = 0
        where patrol_task_standard.del_flag = 0
    </select>
</mapper>
