<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiurt.boot.materials.mapper.EmergencyMaterialsInvoicesMapper">

    <select id="queryList" resultType="com.aiurt.boot.materials.entity.EmergencyMaterialsInvoices">
        select distinct t1.id, t1.standard_code,t1.station_code,t1.line_code,t1.patrol_date,t1.inspection_results,t1.user_id,t1.department_code from emergency_materials_invoices t1
        where 1=1
        <if test="condition.standardCode != null and condition.standardCode != ''">
            and t1.standard_code = #{condition.standardCode}
        </if>
        <if test="condition.lineCode != null and condition.lineCode != ''">
            and t1.line_code = #{condition.lineCode}
        </if>
        <if test="condition.stationCode != null and condition.stationCode != ''">
            and t1.station_code = #{condition.stationCode}
        </if>
        <if test=" condition.positionCode != null and condition.positionCode != ''">
            and t1.position_code = #{condition.positionCode}
        </if>
        <if test="condition.materialsCode != null and condition.materialsCode != ''">
            and id in (select  invoices_id  from emergency_materials_invoices_item where materials_code = #{condition.materialsCode})
        </if>
        <if test="condition.startTime != null and condition.startTime != ''">
            and DATE_FORMAT(patrol_date, '%Y-%m-%d') &gt;= DATE_FORMAT(#{condition.startTime}, '%Y-%m-%d')
        </if>
        <if test="condition.endTime != null and condition.endTime != ''">
            and DATE_FORMAT(patrol_date, '%Y-%m-%d') &lt;= DATE_FORMAT(#{condition.endTime}, '%Y-%m-%d')
        </if>
        <if test="condition.id != null and condition.id != ''">
            and id in (select  invoices_id  from emergency_materials_invoices_item where materials_id = #{condition.id})
        </if>
        order by t1.create_time desc
    </select>
</mapper>
