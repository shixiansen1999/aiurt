<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiurt.boot.plan.mapper.EmergencyPlanMapper">
    <select id="queryPageList" resultType="com.aiurt.boot.plan.entity.EmergencyPlan">
        select ep.*,
        ahp.PROC_INST_ID_ as process_instance_id,
        ara.ID_           as task_id,
        ara.NAME_         as task_name,
        arp.KEY_          as model_key
        from emergency_plan ep
        Left JOIN act_hi_procinst ahp ON ahp.BUSINESS_KEY_ = ep.id
        LEFT join act_ru_task ara ON ara.PROC_INST_ID_ = ahp.PROC_INST_ID_
        LEFT JOIN act_re_procdef arp on ahp.PROC_DEF_ID_ = arp.ID_
        where ep.del_flag = 0
        and ahp.ID_ is not null
        <if test="condition.emergencyPlanName != null and condition.emergencyPlanName != ''">
            and ep.emergency_plan_name = #{condition.emergencyPlanName}
        </if>
        <if test="condition.emergencyPlanType != null and condition.emergencyPlanType != ''">
            and ep.emergency_plan_type = #{condition.emergencyPlanType}
        </if>
        <if test="condition.status != null">
            and ep.status = #{condition.status}
        </if>
        <if test="orgCodes != null and orgCodes.size() > 0">
            and
            ep.org_code in
            <foreach collection="orgCodes" item="item" separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        order by ep.create_time desc
    </select>
</mapper>
