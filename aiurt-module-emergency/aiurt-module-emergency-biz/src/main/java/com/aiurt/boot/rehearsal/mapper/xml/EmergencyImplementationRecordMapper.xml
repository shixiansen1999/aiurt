<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiurt.boot.rehearsal.mapper.EmergencyImplementationRecordMapper">
    <select id="queryPageList" resultType="com.aiurt.boot.rehearsal.vo.EmergencyImplementationRecordVO">
        select eir.*,
               erm.code           as planCode,
               erm.subject,
               erm.rehearsal_time as planRehearsalTime,
               erm.org_code       as deptCode
        from emergency_implementation_record eir
                 left join emergency_rehearsal_month erm on eir.plan_id = erm.id
        where eir.del_flag = 0
        <if test="condition.subject != null and condition.subject != ''">
            and erm.subject like concat('%', #{condition.subject}, '%')
        </if>
        <if test="condition.startDate != null and condition.endDate != null">
            and DATE_FORMAT(erm.rehearsal_time, '%Y-%m-%d')
                between DATE_FORMAT(#{condition.startDate}, '%Y-%m-%d')
            on DATE_FORMAT#{condition.endDate}, '%Y-%m-%d')
        </if>
        <if test="condition.type != null">
            and erm.type = #{condition.type}
        </if>
        <if test="condition.orgCode != null and condition.orgCode != ''">
            and erm.org_code = #{condition.orgCode}
        </if>
        <if test="condition.joinOrgCode != null and condition.joinOrgCode != ''">
        </if>
    </select>
</mapper>
