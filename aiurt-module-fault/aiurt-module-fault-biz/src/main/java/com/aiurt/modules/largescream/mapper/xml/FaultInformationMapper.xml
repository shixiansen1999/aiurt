<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiurt.modules.largescream.mapper.FaultInformationMapper">
    <select id="queryLargeFaultInformation" resultType="com.aiurt.modules.fault.entity.Fault">
        select * from fault
        <where>
            <if test="startDate!=null and endDate!=null">
                and approval_pass_time  &gt;= #{startDate}  and approval_pass_time &lt;= #{endDate}
            </if>
            <if test="lineCode != null">
                and line_code  = #{lineCode}
            </if>
        </where>
    </select>

    <select id="queryLargeFaultInformationTodaySolve" resultType="com.aiurt.modules.fault.entity.Fault">
        select * from fault
        <where>
            status = 12
            <if test="todayStartDate!=null and todayEndDate!=null">
                and end_time  &gt;= #{todayStartDate}  and end_time &lt;= #{todayEndDate}
            </if>
            <if test="lineCode != null">
                and line_code  = #{lineCode}
            </if>
        </where>
    </select>

    <select id="queryLargeFaultInformationTodayAdd" resultType="com.aiurt.modules.fault.entity.Fault">
        select * from fault
        <where>
            <if test="todayStartDate!=null and todayEndDate!=null">
                and happen_time  &gt;= #{todayStartDate}  and happen_time &lt;= #{todayEndDate}
            </if>
            <if test="lineCode != null">
                and line_code  = #{lineCode}
            </if>
        </where>
    </select>

    <select id="getLargeFaultInfo" resultType="com.aiurt.modules.fault.dto.FaultLargeInfoDTO">
        select * from fault f
            left join cs_subsystem cs on cs.system_code = f.sub_system_code
            left join  cs_line cl on cl.line_code = f.line_code
            left join cs_station ct on ct.station_code = f.station_code
        <where>
            <if test="startDate!=null and endDate!=null">
                and f.approval_pass_time  &gt;= #{startDate}  and f.approval_pass_time &lt;= #{endDate}
            </if>
            <if test="lineCode != null">
                and f.line_code  = #{lineCode}
            </if>
        </where>
    </select>

    <select id="getLargeLineFaultInfo" resultType="com.aiurt.modules.fault.entity.Fault">
        select * from fault f
        left join cs_line cl on f.line_code = cl.line_code
        <where>
            <if test="startDate!=null and endDate!=null">
                and f.approval_pass_time  &gt;= #{startDate}  and f.approval_pass_time &lt;= #{endDate}
            </if>
        </where>
    </select>

    <select id="getYearFault" resultType="java.lang.Integer">
        select count(*) from fault where 1=1
        <if test="condition.firstDay != null and condition.firstDay != ''">
            and DATE_FORMAT(create_time ,'%Y-%m-%d') &gt;= DATE_FORMAT(#{condition.firstDay},'%Y-%m-%d')
        </if>
        <if test="condition.lastDay != null and condition.lastDay != ''">
            and DATE_FORMAT(create_time ,'%Y-%m-%d') &lt;= DATE_FORMAT(#{condition.lastDay},'%Y-%m-%d')
        </if>
        <if test="condition.lineCode != null">
            and line_code  = #{condition.lineCode}
        </if>
        <if test="condition.subSystemCode != null and condition.subSystemCode != ''">
            and sub_system_code  = #{condition.subSystemCode}
        </if>
        <if test="condition.faultModeCode != null and condition.faultModeCode != ''">
            and fault_mode_code  = #{condition.faultModeCode}
        </if>
        <if test="condition.status != null">
            and status  = #{condition.status}
        </if>
    </select>

    <select id="getAllSystemCode" resultType="java.lang.String">
        select system_code from cs_subsystem where del_flag = 0
    </select>
</mapper>
