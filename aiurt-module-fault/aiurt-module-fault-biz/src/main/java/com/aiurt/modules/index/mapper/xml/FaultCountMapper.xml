<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiurt.modules.index.mapper.FaultCountMapper">
    <select id="queryFaultCount" parameterType="Date" resultType="com.aiurt.modules.fault.entity.Fault">
        select * from fault
        <where>
            <if test="startDate != null ">
                AND <![CDATA[ approval_pass_time >= #{startDate,jdbcType=DATE}  ]]>
            </if>
            <if test="endDate != null ">
                AND <![CDATA[ approval_pass_time <= #{endDate,jdbcType=DATE}  ]]>
            </if>
        </where>
    </select>


    <select id="getFaultData" resultType="com.aiurt.modules.fault.dto.FaultTimeoutLevelDTO">
        select * from fault
        <where>
            <if test="level == 1">
                AND status &lt;&gt; 12
                and TIMESTAMPDIFF(HOUR,happen_time,now()) &gt;=48
            </if>
            <if test="level == 2">
                AND status &lt;&gt; 12
                and TIMESTAMPDIFF(HOUR,happen_time,now()) &gt;=24
                    and TIMESTAMPDIFF(HOUR,happen_time,now()) &lt;= 48
            </if>
            <if test="level == 3">
                AND status &lt;&gt; 12
                    and TIMESTAMPDIFF(HOUR,happen_time,now()) &gt;=12
                    and TIMESTAMPDIFF(HOUR,happen_time,now()) &lt;= 24
            </if>
            <if test="faultTimeoutLevelReq.startTime!=null and faultTimeoutLevelReq.endTime!=null">
                and approval_pass_time  &gt;= #{faultTimeoutLevelReq.startTime}  and approval_pass_time &lt;= #{faultTimeoutLevelReq.endTime}
            </if>
            <if test="faultTimeoutLevelReq.faultLevel != null">
                and fault_level  = #{faultTimeoutLevelReq.faultLevel}
            </if>
            <if test="faultTimeoutLevelReq.status != null">
                and status  = #{faultTimeoutLevelReq.status}
            </if>
            <if test="faultTimeoutLevelReq.appointUserName != null">
                and appoint_user_name  like concat( '%' , #{faultTimeoutLevelReq.appointUserName}, '%')
            </if>
            <if test="faultTimeoutLevelReq.faultModeCode != null">
                and fault_mode_code  = #{faultTimeoutLevelReq.faultModeCode}
            </if>
        </where>
    </select>

    <select id="getDailyFaultNum" resultType="com.aiurt.modules.fault.entity.Fault">
        select * from fault
        where status = 12  and date_format(end_time ,'%Y-%m-%d') =date_format(#{dateTime} ,'%Y-%m-%d')
    </select>

    <select id="getMainFaultCondition" resultType="com.aiurt.modules.fault.dto.FaultTimeoutLevelDTO">
        select * from fault
        where status = 12  and date_format(end_time ,'%Y-%m-%d') =date_format(#{startDate} ,'%Y-%m-%d')
    </select>
</mapper>
