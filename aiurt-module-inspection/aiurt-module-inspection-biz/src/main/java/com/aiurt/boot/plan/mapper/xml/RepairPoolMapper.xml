<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiurt.boot.plan.mapper.RepairPoolMapper">
    <resultMap id="query_major_map" type="com.aiurt.boot.manager.dto.MajorDTO">
        <result column="major_code" property="majorCode"></result>
        <result column="major_name" property="majorName"></result>
        <collection property="subsystemDTOList" javaType="list" ofType="com.aiurt.boot.manager.dto.SubsystemDTO">
            <result column="system_code" property="systemCode"></result>
            <result column="system_name" property="systemName"></result>
        </collection>
    </resultMap>
    <select id="queryList" resultType="com.aiurt.boot.plan.entity.RepairPool">

    </select>
    <select id="queryMajorList" resultMap="query_major_map">
        SELECT cm.major_code,cm.major_name,cs.system_code,cs.system_name FROM cs_major cm
        LEFT JOIN cs_subsystem cs ON cs.major_code = cm.major_code
        <where>
            cm.del_flag = 0 and cs.del_flag=0
            <if test="majorCode.size()>0">
                and cm.major_code in
                <foreach collection="majorCode" item="code" separator="," open="(" close=")">
                    #{code}
                </foreach>
            </if>
            <if test="subSystemCode.size()>0">
                and cs.system_code in
                <foreach collection="subSystemCode" item="code" separator="," open="(" close=")">
                    #{code}
                </foreach>
            </if>
        </where>
    </select>
    <select id="queryStandardByCode" resultType="com.aiurt.boot.plan.entity.RepairPoolCode">
        select major_code,subsystem_code from repair_pool_code rpc
        left join repair_pool_rel rpr on rpr.repair_pool_sta_id = rpc.id
        left join repair_pool rp on rp.code = rpr.repair_pool_code
        where  rp.code = #{planCode} and rpc.del_flag =0 and rpr.del_flag= 0 and rp.del_flag = 0
    </select>
    <select id="selectOrgByCode" resultType="java.lang.String">
        select org_code from  repair_pool_org_rel where del_flag = 0 and repair_pool_code = #{planCode}
    </select>
    <select id="getCodeByMajor" resultType="java.lang.String">
        SELECT DISTINCT repair_pool_code FROM repair_pool_rel rpr
        LEFT JOIN repair_pool_code rpc ON rpc.id = rpr.repair_pool_sta_id
        <where>
            rpr.del_flag =0
            <if test="majorList.size()>0">
                and rpc.major_code in
                <foreach collection="majorList" separator="," open="(" close=")" item="majorcode">
                    #{majorcode}
                </foreach>
            </if>
        </where>
    </select>
    <select id="getInspectionData" resultType="com.aiurt.boot.index.dto.InspectionDTO">
        select code,weeks,status from repair_pool
        <where>
            del_flag = 0
            <if test="beginDate!=null and endDate!=null">
             and start_time &gt;= #{beginDate}
             and start_time &lt;=#{endDate}
            </if>
            <if test="codeList.size()>0">
                and code in
                <foreach collection="codeList" separator="," open="(" close=")" item="code">
                    #{code}
                </foreach>
            </if>
            <if test="item!=null and item==2">
                and status = #{item}
            </if>
        </where>
    </select>
    <select id="getInspectionTodayData" resultType="com.aiurt.boot.index.dto.InspectionDTO">
        select code,weeks,status from repair_pool
        <where>
            del_flag = 0
            <if test="date!=null">
                and start_time &lt;= #{date}
                and end_time &gt;=#{date}
            </if>
            <if test="codeList.size()>0">
                and code in
                <foreach collection="codeList" separator="," open="(" close=")" item="code">
                    #{code}
                </foreach>
            </if>
        </where>
    </select>


</mapper>
