<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiurt.modules.system.mapper.SysUserPerfMapper">
    <select id="getPerformance" resultType="com.aiurt.modules.personnelportrait.dto.RadarPerformanceModelDTO">
        select sup.user_id, avg(sup.score) score
        from sys_user_perf sup
                 join sys_user su on (sup.user_id = su.id and su.del_flag = 0)
        where sup.del_flag = 0
          and date_format(str_to_date(concat(sup.year, lpad(sup.month, 2, '0'), '01'), '%Y%m%d'), '%Y%m') >=
              date_format(#{date}, '%Y%m')
          and su.org_code = #{orgCode}
        group by sup.user_id
    </select>
</mapper>
