<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiurt.modules.position.mapper.CsStationPositionMapper">

    <select id="queryCsStationPositionAll"  resultType="com.aiurt.modules.position.entity.CsStationPosition">
        SELECT
            t.id,'' length,
            '1' level,
            t.sort,
            t.line_code position_code,
            t.line_name position_name,
            t.line_type position_type,
            '-' pUrl
        FROM
            cs_line t
        <where>
            <if test="position.positionType != null  and position.positionType != ''"> and t.line_type = #{position.positionType}</if>
            <if test="position.positionName != null  and position.positionName != ''"> and t.line_name like concat('%', #{position.positionName}, '%')</if>
            <if test="position.code != null  and position.code != ''"> and t.line_code = #{position.code}</if>
            and t.del_flag = 0
        </where>
        UNION
        SELECT
            t1.id,'' length,
            '2' level,
            t1.sort,
            t1.station_code position_code,
            t1.station_name position_name,
            t1.station_type position_type,
            t.line_name pUrl
        FROM
            cs_station t1
        LEFT JOIN cs_line t ON t.line_code = t1.line_code
        <where>
            <if test="position.positionType != null  and position.positionType != ''"> and t1.station_type = #{position.positionType}</if>
            <if test="position.positionName != null  and position.positionName != ''"> and t1.station_name like concat('%', #{position.positionName}, '%')</if>
            <if test="position.code != null  and position.code != ''"> and (t1.line_code = #{position.code} or t1.station_code = #{position.code})</if>
            and t1.del_flag = 0
        </where>
        UNION
        SELECT
            t2.id,t2.length,
            '3' level,
            t2.sort,
            t2.position_code,
            t2.position_name,
            t2.position_type,
            t.station_name pUrl
        FROM
            cs_station_position t2
        LEFT JOIN cs_station t ON t.station_code = t2.staion_code
        <where>
            <if test="position.positionType != null  and position.positionType != ''"> and t2.position_type = #{position.positionType}</if>
            <if test="position.positionName != null  and position.positionName != ''"> and t2.position_name like concat('%', #{position.positionName}, '%')</if>
            <if test="position.code != null  and position.code != ''"> and (t2.line_code = #{position.code} or  t2.staion_code = #{position.code} or t2.position_code = #{position.code})</if>
            and t2.del_flag = 0
        </where>
        order by level,sort
    </select>
</mapper>
