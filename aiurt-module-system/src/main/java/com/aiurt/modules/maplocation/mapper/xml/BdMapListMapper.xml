<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiurt.modules.maplocation.mapper.BdMapListMapper">
    <select id="queryPositionById" parameterType="string"
            resultType="com.aiurt.modules.maplocation.dto.CurrentTeamPosition">
        SELECT
        sy.id as userId,
        sy.realname as name,
        sp.longitude as positionX,
        sp.latitude as positionY,
        sp.upload_time as positionUpdateTime,
        sy.username
        FROM
        sys_user sy
        left join  sys_user_position sp on sp.create_by = sy.username
        <where>
            sy.del_flag = 0
           and sy.id in
            <foreach collection="userIdList" item="id" index="index" open="(" close=")" separator=",">
                #{id}
            </foreach>
        </where>
    </select>
    <select id="getUserList" parameterType="string" resultType="com.aiurt.modules.maplocation.dto.UserInfo">
        select id,position_x,position_y
        from sys_user
        <where>
            <if test="id!=null and id!=''">
                id = #{id}
            </if>
        </where>
    </select>
    <select id="getUserByTeamIdList" parameterType="list" resultType="com.aiurt.modules.maplocation.dto.UserInfo">
        select id,realname as name,username  from sys_user
        <where>
            <if test="teamChild.size()>0">
                team_id in
                <foreach collection="teamChild" item="id" index="index" open="(" close=")" separator=",">
                    #{id}
                </foreach>
            </if>
        </where>
    </select>
    <select id="getUserById" parameterType="string" resultType="com.aiurt.modules.maplocation.dto.UserInfo">
        select sy.id,sy.username as userName,sy.realname as name,sy.safe_level, sy.identity_number, sy.phone from sys_user sy
        where sy.id=#{id}
    </select>
    <select id="getAllEquipmentList" resultType="com.aiurt.modules.maplocation.dto.EquipmentDTO">
        select bda.id,bs.position_x,bs.position_y from  bd_device_archives bda
        LEFT JOIN  bd_station bs on bs.id = bda.station_id
    </select>

    <select id="selectEquipment" resultType="com.aiurt.modules.maplocation.dto.EquipmentHistoryDTO">
        SELECT
        bda.device_code,
        bdt.NAME AS typeName,
        bds.state,
        bda.position,
        bda.NAME AS deviceName
        FROM
        bd_device_archives bda
        LEFT JOIN bd_device_type bdt ON bdt.id = bda.type_id
        LEFT JOIN bd_device_state bds ON bds.id = bda.state
        <where>
            bda.station_id = #{stationIdStr}
            <if test="teamIdList.size()>0">
                and (
                bda.check_team_id in
                <foreach collection="teamIdList" item="id" index="index" open="(" close=")" separator=",">
                    #{id}
                </foreach>
                or
                bda.repair_team_id in
                <foreach collection="teamIdList" item="id" index="index" open="(" close=")" separator=",">
                    #{id}
                </foreach>
                or
                bda.check_repair_team_id in
                <foreach collection="teamIdList" item="id" index="index" open="(" close=")" separator=",">
                    #{id}
                </foreach>
                )
            </if>
        </where>
    </select>
    <select id="getAllTeam" resultType="com.aiurt.common.api.vo.TreeNode">
        select id,name,parent_id as pid from bd_team
    </select>
    <select id="queryUserById" resultType="com.aiurt.modules.maplocation.dto.UserInfo">
        select id, realname as name
        from sys_user
        where id in
        <foreach collection="idList" item="id" index="index" open="(" close=")" separator=",">
            #{id}
        </foreach>
    </select>
    <select id="getStationId" parameterType="string" resultType="com.aiurt.modules.maplocation.dto.UserStationDTO">
        SELECT
        su.position_x,
        su.position_y
        from sys_user su
        <where>
            su.position_x IS NOT NULL
            AND su.position_y IS NOT NULL
            <if test="id!=null and id !=''">
                and su.id = #{id}
            </if>
        </where>
    </select>
</mapper>
