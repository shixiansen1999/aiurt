<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiurt.modules.stock.mapper.StockOutOrderLevel2Mapper">
    <select id="pageList" resultType="com.aiurt.modules.stock.entity.StockOutOrderLevel2">
        select stock_out_order_level2.*, spa.status, mr.code as materialRequisitionCode
        from stock_out_order_level2 stock_out_order_level2
        left join spare_part_stock_info spsi on stock_out_order_level2.custodial_warehouse_code = spsi.warehouse_code and spsi.del_flag = 0
        left join spare_part_apply spa on stock_out_order_level2.apply_code=spa.code and spa.del_flag = 0
        left join material_requisition mr on mr.id = stock_out_order_level2.material_requisition_id
        <where>
            and stock_out_order_level2.del_flag = 0
            <if test="condition.orderCode != null and condition.orderCode != ''">
                and stock_out_order_level2.order_code like concat(concat('%',#{condition.orderCode}),'%')
            </if>
            <if test="condition.warehouseName != null and condition.warehouseName != ''">
                and spsi.warehouse_name like concat(concat('%',#{condition.warehouseName}),'%')
            </if>
            <if test="condition.custodialWarehouseCode != null and condition.custodialWarehouseCode != ''">
                and spsi.warehouse_code = #{condition.custodialWarehouseCode}
            </if>
            <if test="condition.outTimeBegin != null and condition.outTimeEnd != null">
                and Date(stock_out_order_level2.out_time) &gt;= #{condition.outTimeBegin} and Date(stock_out_order_level2.out_time) &lt;= #{condition.outTimeEnd}
            </if>
            <if test="condition.userOrgCodes != null and condition.userOrgCodes.size() > 0">
                and spsi.org_code in
                <foreach collection="condition.userOrgCodes" index="index" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
        </where>
        order by stock_out_order_level2.create_time desc
    </select>
    <select id="selectListAll" resultType="com.aiurt.modules.stock.entity.StockOutOrderLevel2">
        select stock_out_order_level2.custodial_warehouse_code, spsi.warehouse_name custodial_warehouse_name
        from stock_out_order_level2 stock_out_order_level2
        left join spare_part_stock_info spsi on stock_out_order_level2.custodial_warehouse_code = spsi.warehouse_code and spsi.del_flag = 0
        <where>
            and stock_out_order_level2.del_flag = 0 and stock_out_order_level2.custodial_warehouse_code is not null
        </where>
        group by stock_out_order_level2.custodial_warehouse_code
        order by stock_out_order_level2.create_time desc
    </select>
</mapper>
