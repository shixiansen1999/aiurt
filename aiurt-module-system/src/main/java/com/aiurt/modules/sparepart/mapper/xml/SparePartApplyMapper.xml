<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiurt.modules.sparepart.mapper.SparePartApplyMapper">
    <select id="selectExportXls" resultType="com.aiurt.modules.sparepart.entity.SparePartApply">
        SELECT
            d1.item_text status,
            spare_part_apply.CODE code,
            t1.warehouse_name applyWarehouse,
            t2.warehouse_name custodialWarehouse,
            spare_part_apply.apply_number applyNumber,
            t3.realname applyUser,
            spare_part_apply.apply_time applyTime,
            spare_part_apply.remarks
        FROM
            spare_part_apply spare_part_apply
        LEFT JOIN sys_dict AS dict1 ON dict1.dict_code = 'spare_apply_status'
        LEFT JOIN sys_dict_item AS d1 ON d1.item_value = spare_part_apply.STATUS AND dict1.id = d1.dict_id
        LEFT JOIN stock_level2_info t1 ON t1.warehouse_code = spare_part_apply.apply_warehouse_code
        LEFT JOIN spare_part_stock_info t2 ON t2.warehouse_code = spare_part_apply.custodial_warehouse_code
        LEFT JOIN sys_user t3 ON t3.username = spare_part_apply.apply_user_id

        where spare_part_apply.del_flag= 0
            and spare_part_apply.id in(
            <foreach collection="ids" separator="," item="item">
                #{item}
            </foreach>
        )
    </select>
    <select id="readAll" resultType="com.aiurt.modules.sparepart.entity.SparePartApply">
        select spare_part_apply.*,t1.warehouse_name warehouseName
        from spare_part_apply spare_part_apply
        left join spare_part_stock_info t1 on spare_part_apply.custodial_warehouse_code = t1.warehouse_code

        <where>
            spare_part_apply.del_flag= 0
            <if test="sparePartApply.code != null and sparePartApply.code != ''">
                and spare_part_apply.code like concat(concat('%',#{sparePartApply.code}),'%')
            </if>
            <if test="sparePartApply.warehouseName != null and sparePartApply.warehouseName != ''">
                and t1.warehouse_name = #{sparePartApply.warehouseName}
            </if>
            <if test="sparePartApply.status != null and sparePartApply.status != null">
                and spare_part_apply.status = #{sparePartApply.status}
            </if>
        </where>
        order by spare_part_apply.create_time desc
    </select>

    <select id="getDepartByWarehouseCode" resultType="java.lang.String">
        select `org_code` from spare_part_stock_info where warehouse_code = #{applyWarehouseCode}
    </select>
</mapper>
