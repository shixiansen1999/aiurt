<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiurt.modules.sparepart.mapper.SparePartInOrderMapper">
    <select id="queryPageList"
            resultType="com.aiurt.modules.sparepart.entity.vo.SparePartInVO">
        select spio.id,spio.material_code materialCode,mb.name materialName,mb.type,
        mb.specifications,mb.country_origin countryOrigin,
        mb.manufacturer,mb.brand,mb.unit,spio.num,w.warehouse_name warehouseName,
        su.realname keeperName
        from spare_part_in_order spio
        left join spare_part_stock_info w on w.warehouse_code=spio.warehouse_code
        left join material_base mb on mb.code=spio.material_code
        left join sys_user su on su.id=spio.create_by
        where 1=1 and spio.del_flag!=1
        <if test="sparePartInQuery.materialCode!=null and sparePartInQuery.materialCode!=''">
            and spio.material_code = #{sparePartInQuery.materialCode}
        </if>
        <if test="sparePartInQuery.materialName!=null and sparePartInQuery.materialName!=''">
            and mb.name like concat('%', #{sparePartInQuery.materialName}, '%')
        </if>
        <if test="sparePartInQuery.type!=null and sparePartInQuery.type!=''">
            and mb.type = #{sparePartInQuery.type}
        </if>
        <if test="sparePartInQuery.warehouseCode!=null and sparePartInQuery.warehouseCode!=''">
            and spio.warehouse_code = #{sparePartInQuery.warehouseCode}
        </if>
        order by  spio.create_time desc
    </select>
    <select id="exportXls" resultType="com.aiurt.modules.sparepart.entity.dto.SparePartInExcel">
        select spio.id,spio.material_code materialCode,mb.name materialName,mb.type,
        mb.specifications,mb.country_origin countryOrigin,
        mb.manufacturer,mb.brand,mb.unit,spio.num,w.warehouse_name warehouseName,
        su.realname keeperName
        from spare_part_in_order spio
        left join spare_part_stock_info w on w.warehouse_code=spio.warehouse_code
        left join material_base mb on mb.code=spio.material_code
        left join sys_user su on su.id=spio.create_by
        where 1=1 and spio.del_flag!=1
        <if test="sparePartInQuery.materialCode!=null and sparePartInQuery.materialCode!=''">
            and spio.material_code = #{sparePartInQuery.materialCode}
        </if>
        <if test="sparePartInQuery.materialName!=null and sparePartInQuery.materialName!=''">
            and mb.name like concat('%', #{sparePartInQuery.materialName}, '%')
        </if>
        <if test="sparePartInQuery.type!=null and sparePartInQuery.type!=''">
            and mb.type = #{sparePartInQuery.type}
        </if>
        <if test="sparePartInQuery.warehouseCode!=null and sparePartInQuery.warehouseCode!=''">
            and spio.warehouse_code = #{sparePartInQuery.warehouseCode}
        </if>
        order by  spio.create_time desc
    </select>
</mapper>
